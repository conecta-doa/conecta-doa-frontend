<ng-container *ngIf="auth.hasToken(); else publicHeader">
  <app-donor-header></app-donor-header>
</ng-container>
<ng-template #publicHeader>
  <app-header></app-header>
</ng-template>

<!-- Loading State -->
<div *ngIf="isLoading" class="loading-container">
  <p>Carregando instituiÃ§Ã£o...</p>
</div>

<!-- Error State -->
<div *ngIf="errorMessage && !isLoading" class="error-container">
  <p>{{ errorMessage }}</p>
  <button class="btn-retry" (click)="loadInstitution()">Tentar Novamente</button>
</div>

<!-- Main Content -->
<div *ngIf="!isLoading && !errorMessage && institution" class="instituicao-container">
  <div class="instituicao-card">
    <img
      [src]="institution.image"
      [alt]="institution.name"
      class="instituicao-img"
      (error)="handleImageError($event)"
    />

    <div class="instituicao-info">
      <h2>{{ institution.name }}</h2>
      <p>{{ institution.description }}</p>
      <div class="instituicao-contato">
        <span>ğŸ“ {{ institution.location }}</span>
        <span>ğŸ“ {{ institution.phone }}</span>
        <span>âœ‰ï¸ {{ institution.email }}</span>
      </div>
    </div>
    <button class="btn-doar" (click)="donate()">ğŸ’– Doar Agora</button>
  </div>

  <div class="tabs-container">
    <div class="tabs">
      <button class="tab" [class.active]="isAbaAtiva('sobre')" (click)="selecionarAba('sobre')">
        Sobre
      </button>

      <button
        class="tab"
        [class.active]="isAbaAtiva('necessidades')"
        (click)="selecionarAba('necessidades')"
      >
        Necessidades
      </button>
    </div>

    <div class="tab-content" *ngIf="isAbaAtiva('sobre')">
      <p>
        Este projeto tem como objetivo conectar doadores e instituiÃ§Ãµes de forma simples e
        solidÃ¡ria.
      </p>
      <!-- Add more about content here -->
    </div>

    <div class="tab-content" *ngIf="isAbaAtiva('necessidades')">
      <!-- Financial Contributions -->
      <div class="contribuicao-header">
        <span class="emoji">ğŸ’°</span>
        <h3>ContribuiÃ§Ãµes Financeiras</h3>
      </div>

      <div class="contribuicao-card">
        <div class="progresso-section">
          <p class="progresso-titulo">Meta Mensal de ArrecadaÃ§Ã£o</p>
          <div class="barra-container">
            <div class="barra-preenchida" [style.width.%]="progresso"></div>
          </div>
          <div class="progresso-info">
            <span>
              Arrecadado: R$ {{ arrecadado | number : '1.2-2' }} de R$
              {{ meta | number : '1.2-2' }}
            </span>
            <span class="porcentagem">{{ progresso }}%</span>
          </div>
        </div>
        <button class="btn-contribuir" (click)="donate()">ğŸ’µ Contribuir Financeiramente</button>
      </div>

      <!-- Dynamic Donation Items -->
      <div *ngFor="let category of ['food', 'clothing', 'education']">
        <div class="contribuicao-header" *ngIf="getItemsByCategory(category).length">
          <span class="emoji">{{ getCategoryEmoji(category) }}</span>
          <h3>{{ getCategoryName(category) }}</h3>
        </div>

        <div
          [class]="
            getItemsByCategory(category).length > 1 ? 'necessidades-grid' : 'necessidade-single'
          "
        >
          <div *ngFor="let item of getItemsByCategory(category)" class="necessidade-card">
            <h4>{{ item.title }}</h4>
            <p>{{ item.description }}</p>
            <div class="progresso-section" *ngIf="item.required > 0">
              <div class="barra-container">
                <div
                  class="barra-preenchida"
                  [style.width.%]="getProgressPercentage(item.current, item.required)"
                ></div>
              </div>
              <div class="progresso-info">
                <span> Arrecadado: {{ item.current }} de {{ item.required }} {{ item.unit }} </span>
                <span class="porcentagem">
                  {{ getProgressPercentage(item.current, item.required) }}%
                </span>
              </div>
            </div>
            <button class="btn-doar" (click)="donateItem(item)">
              {{ getCategoryEmoji(category) }} Doar {{ item.title }}
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
